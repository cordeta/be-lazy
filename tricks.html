<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>
<h1 id="a-handbook-for-the-lazy">A Handbook for the Lazy</h1>
<hr />
<p>by Lorenzo Rovigatti</p>
<h1 id="table-of-contents">Table of Contents</h1>
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#how-to-use-this-book">How to use this book</a></li>
</ul></li>
<li><a href="#bash">Bash</a>
<ul>
<li><a href="#files-and-directories">Files and directories</a></li>
<li><a href="#redirection-and-piping">Redirection and piping</a></li>
<li><a href="#if-statements">&quot;if&quot; statements</a></li>
<li><a href="#for-loops">&quot;for&quot; loops</a></li>
<li><a href="#useful-shortcuts">Useful shortcuts</a></li>
</ul></li>
<li><a href="#command-line-tools"><del>Command-line tools</del></a>
<ul>
<li><a href="#awk"><del>AWK</del></a></li>
<li><a href="#cat-cut-and-paste"><del>cat, cut and paste</del></a></li>
<li><a href="#grep-find-and-locate"><del>grep, find and locate</del></a></li>
</ul></li>
<li><a href="#plotting"><del>Plotting</del></a>
<ul>
<li><a href="#xmgrace"><del>xmgrace</del></a></li>
</ul></li>
<li><a href="#ssh">SSH</a>
<ul>
<li><a href="#how-to-avoid-wasting-time">How to avoid wasting time</a>
<ul>
<li><a href="#ssh-keys">SSH keys</a></li>
<li><a href="#ssh-config-file">SSH config file</a></li>
</ul></li>
<li><a href="#escape-sequences">Escape sequences</a></li>
</ul></li>
<li><a href="#debugging">Debugging</a>
<ul>
<li><a href="#gdb">GDB</a></li>
</ul></li>
<li><a href="#uncategorized">Uncategorized</a>
<ul>
<li><a href="#setting-up-nfs">Setting up NFS</a></li>
<li><a href="#making-movies">Making movies</a></li>
<li><a href="#adding-a-fading-rounded-border-to-figures-with-gimp">Adding a fading, rounded border to figures with GIMP</a></li>
</ul></li>
</ul>
<h1 id="introduction">Introduction</h1>
<p>I am a computational physicist and I spend most of the day in front of a computer. I consider myself quite the lazy person, and I find many of the daily tasks that are associated with my job to be extremely boring and repetitive. During the course of the years I have developed my own way of dealing with these chores.</p>
<p>These notes contain many tricks of the trade I routinely use during my everyday job to make my life easier and, which is of the outmost importance for me, less boring. I am sure many of the solutions I have found to cope with these common issues can be solved in multiple ways. I am equally sure that many of the solutions I overlooked are plain better than the paths I chose to take. If you find that this is the case, feel free to drop me a line at <script type="text/javascript">
<!--
h='&#x67;&#x6d;&#x61;&#x69;&#108;&#46;&#x63;&#x6f;&#x6d;';a='&#64;';n='&#108;&#x6f;&#114;&#x65;&#110;&#122;&#x6f;&#46;&#114;&#x6f;&#118;&#x69;&#x67;&#x61;&#116;&#116;&#x69;';e=n+a+h;
document.write('<a h'+'ref'+'="ma'+'ilto'+':'+e+'" clas'+'s="em' + 'ail">'+e+'<\/'+'a'+'>');
// -->
</script><noscript>&#108;&#x6f;&#114;&#x65;&#110;&#122;&#x6f;&#46;&#114;&#x6f;&#118;&#x69;&#x67;&#x61;&#116;&#116;&#x69;&#32;&#x61;&#116;&#32;&#x67;&#x6d;&#x61;&#x69;&#108;&#32;&#100;&#x6f;&#116;&#32;&#x63;&#x6f;&#x6d;</noscript> or to add your own solution to the book and create a pull request!</p>
<h2 id="how-to-use-this-book">How to use this book</h2>
<p>The book is written in <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> and translated to HTML using <a href="https://pandoc.org/">Pandoc</a>.</p>
<p>The <code>tricks.md</code> and <code>tricks.html</code> files contain the entirety of the book in Markdown and HTML format, respectively.</p>
<p>If you want to change the content of the book just edit one or more chapter files and then, if you have Bash and Pandoc installed on your system (and the Pandoc executable is in your path) compile the book from the source by running the <code>compile.sh</code> script. This will generate the <code>tricks.md</code>, <code>tricks.html</code> and <code>README.md</code> files.</p>
<p>This is not a book to be read in one take. On the contrary, it should be considered as a collection of tips &amp; tricks to be referred to when the need arises.</p>
<p>I plan to add as many figures and examples as possible. These will be included in the source of the book.</p>
<p><a href="https://creativecommons.org/licenses/by/4.0/"><img src="https://licensebuttons.net/l/by/4.0/80x15.png" alt="License: CC BY 4.0" /></a></p>
<hr />
<h1 id="bash">Bash</h1>
<p>In the following I will assume that Bash is the default shell of your system and that you know how to start a new terminal, which usually boils down to writing &quot;terminal&quot; in your OS' search bar and starting up the first search result.</p>
<p><a href="https://www.gnu.org/software/bash/">Bash</a> is probably the most common <a href="https://en.wikipedia.org/wiki/Unix_shell">Unix shell</a>. It is the default login shells of many LInux distributions, as well as of Apple's Mac OS X. For our purposes, Bash is the command line through which we communicate with and operate on the files and directories stored on the filesystem.</p>
<h2 id="files-and-directories">Files and directories</h2>
<h2 id="redirection-and-piping">Redirection and piping</h2>
<h2 id="if-statements">&quot;if&quot; statements</h2>
<h2 id="for-loops">&quot;for&quot; loops</h2>
<h2 id="useful-shortcuts">Useful shortcuts</h2>
<ul>
<li><code>!PATTERN</code> execute the most recent command in the shell history that begins with PATTERN (<em>e.g.</em> <code>!xm</code> will likely execute the last <code>xmgrace</code> command issued)</li>
<li><code>ctrl + a</code> go to the beginning of the line</li>
<li><code>ctrl + e</code> go to the end of the line</li>
<li><code>ctrl + k</code> cut line after the cursor</li>
<li><code>ctrl + u</code> cut line before the cursor</li>
<li><code>alt + backspace</code> cut the word after the cursor</li>
<li><code>ctrl + w</code> cut the word before the cursor</li>
<li><code>ctrl + y</code> paste back the last thing you cut</li>
<li><code>ctrl + p</code> previous command</li>
<li><code>ctrl + n</code> next command</li>
<li><code>ctrl + r</code> backward interactive command search</li>
<li><code>ctrl + s</code> forward interactive command search (<strong>NB:</strong> <code>stty -ixon</code> should be first added to .bashrc)</li>
</ul>
<hr />
<h1 id="command-line-tools"><del>Command-line tools</del></h1>
<h2 id="awk"><del>AWK</del></h2>
<h2 id="cat-cut-and-paste"><del>cat, cut and paste</del></h2>
<h2 id="grep-find-and-locate"><del>grep, find and locate</del></h2>
<hr />
<h1 id="plotting"><del>Plotting</del></h1>
<h2 id="xmgrace"><del>xmgrace</del></h2>
<hr />
<h1 id="ssh">SSH</h1>
<p>Connecting through <a href="https://en.wikipedia.org/wiki/Secure_Shell">SSH</a> to a remote machine (be it your office computer, home desktop or HPC cluster) is one of the most common operations in the daily routine of many people who do this job. If you are one of these people, you will likely find yourself SSH-ing to this or that computer quite often. If you have an account <code>lorenzo</code> on the <code>powercluster.cool.univ.com</code> machine, you can use the following command to establish a remote connection with it<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<pre><code>$ ssh lorenzo@powercluster.cool.univ.com</code></pre>
<p>You will then be asked to input your password after which you will be given a shell on the remote machine. Some cautious (paranoid?) sys-admins like to disable the 22 port on which the ssh <a href="https://en.wikipedia.org/wiki/Daemon_(computing)">daemon</a> listens by default. If you try to connect to a remote machine and you receive a <code>Connection refused</code> error, this might be way. In order to connect through another port (port 123456, for instance) use the <code>-p</code> option, like this:</p>
<pre><code>$ ssh -p 123456 lorenzo@powercluster.cool.univ.com</code></pre>
<p><strong>Nota Bene:</strong> if you are using <code>scp</code> to copy files from/to a remote machine that accepts SSH connections only through a non-22 port, make sure you add <code>-P port</code> (with a capital <code>P</code>) and not <code>-p port</code> like you would do with <code>ssh</code>.</p>
<h2 id="how-to-avoid-wasting-time">How to avoid wasting time</h2>
<p>If you find yourself typing the commands written above over and over, you will quickly realise how annoying it can get, especially if you have multiple computers you often connect to<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>. There are two (complementary) ways to save a lot of keystrokes:</p>
<ol style="list-style-type: decimal">
<li>Set up ssh keys</li>
<li>Set up the list of hosts in the ssh config file</li>
</ol>
<h3 id="ssh-keys">SSH keys</h3>
<p>I will not delve into the technicalities of SSH keys because I am not expert and because I do not think this is the right place to have such a discussion. If you are interested you can find many resources online, starting, for instance, from <a href="https://www.ssh.com/ssh/key/">here</a>.</p>
<p>Here it suffices to know that you can set up the SSH connection between your local machine and a remote one so that you will not have to enter any password when using it. In order to do so, you will have to first generate an <em>SSH key</em> on your local machine. This can be done with the following command</p>
<pre><code>$ ssh-keygen -t rsa</code></pre>
<p>The first thing you will be asked is where to store the key. If you leave the field empty the key will be saved in the <code>~/.ssh/id_rsa</code> location, with <code>~</code> being your home directory. You will be then asked twice to enter a passphrase, which can be left empty. There can be security reasons why you would want to enter a non-empty passphrase. However, using a non-empty passphrase would defeat the purpose of this section, as it would make SSH ask for that passphrase every time you want to login on the remote machines you have copied your key to. In the following I will assume you saved the key to the default location and did not enter a passphrase during the key generation.</p>
<p><strong>Nota Bene:</strong> the key you have generated is a (sort of) fingerprint of your user on the <em>specific</em> local machine you are generating it on. This means that you have to undergo this procedure once for each computer you connect <em>from</em>, regardless of the number of remote machines you will connect <em>to</em>.</p>
<p>On many systems there exists the <code>ssh-copy-id</code> utility that copies your key over to the right position on the remote machine. If this is your case just call it with the command line options you would use if you were to connect to the remote machine through the usual SSH command. For example,</p>
<pre><code>$ ssh-copy-id lorenzo@powercluster.cool.univ.com</code></pre>
<p>or, if you need to use a custom port:</p>
<pre><code>$ ssh-copy-id -p 123456 lorenzo@powercluster.cool.univ.com</code></pre>
<p>if everything goes smoothly this is the last time you will have to enter your password to connect to that specific remote computer 😄</p>
<p>If your system lacks <code>ssh-copy-id</code> you will have to manually add your public key to the list of <em>authorized keys</em> stored on the remote machine. In order to do so you will have to</p>
<ol style="list-style-type: decimal">
<li><p>copy your public key, stored in the <code>~/.ssh/id_rsa.pub</code> file (here I am assuming your <code>ssh-keygen</code> was told to put the key in the default location). You should expect it to look like this:</p>
<pre>ssh-rsa GIBBERISH lorenzo@lorenzo-desktop</pre>
where <code>GIBBERISH</code> is a very long string of seemingly random characters and the last token is just <code>your_username@your_host</code></li>
<li><p>establish a connection with the target remote machine and, with your preferred editor, open the <code>~/.ssh/authorized_keys</code> file. Paste your public key on a new line, save and exit</p></li>
</ol>
<p><em>Et voilà</em>: SSH will not prompt you for the password when accessing this specific remote machine any more!</p>
<p><strong>Nota Bene:</strong> the aforementioned procedure lets you SSH passwordlessly from <code>user_on_A_host@A_host</code> to <code>user_on_B_host@B_host</code>. If you change either the user or the host from which you connect <em>from</em>, you will have to redo the proceudre. If you change either the user or the host you connect <em>to</em> you will have to update the corresponding <code>authorized_keys</code> file by adding the public key you already have.</p>
<h3 id="ssh-config-file">SSH config file</h3>
<p>In this section we will see how to transform this:</p>
<pre><code>$ ssh -p 123456 lorenzo@powercluster.cool.univ.com</code></pre>
<p>Into this:</p>
<pre><code>$ ssh pc</code></pre>
<p>Looks neat, doesn't it? With SSH, just open the file <code>~/.ssh/config</code> (which may not exist yet) and, for each combination of <code>user@host</code> you want to create aliases for, add a few lines that specify the parameters for that specific connection, like this:</p>
<pre><code>Host pc
HostName powercluster.cool.univ.com
User lorenzo
Port 123456</code></pre>
<p>Save and exit. From now on you will be able to use <code>ssh pc</code> in place of <code>ssh -p 123456 lorenzo@powercluster.cool.univ.com</code>: you do not need to reload or restart anything.</p>
<p>A few comments:</p>
<ol style="list-style-type: decimal">
<li>You can omit the <code>User</code> and <code>Port</code> fields if the default values (the current user and port 22, respectively) are fine</li>
<li><p>You can set default values for all or some hosts by using wildcards. For example</p>
<pre>
Host *univ.com
User rovigatti

Host *
User lorenzo
</pre>
<p><strong>Nota Bene:</strong> the order with which you list the hosts is very important! SSH parses the <code>config</code> file from the top downwards and uses the <em>first</em> value found for each option whose corresponding <code>Host</code> matches the hostname given on the command line. For instance, in the above listing, inverting the order of the hosts will make SSH always use the username <code>lorenzo</code>, even for hostnames that match the <code>*univ.com</code> pattern.</p></li>
<li><p>The list of available fields is <a href="https://www.ssh.com/ssh/config/">here</a>. A simpler tutorial can be found here <a href="https://www.digitalocean.com/community/tutorials/how-to-configure-custom-connection-options-for-your-ssh-client">here</a></p></li>
</ol>
<h2 id="escape-sequences">Escape sequences</h2>
<p>OpenSSH provides a variety of escape sequences that can be used during SSH sessions, even when the terminal is unresponsive <a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>. Typing <code>~?</code> (a tilde followed by a question mark) during an SSH session will print the list of available escape sequences which, with my OpenSSH client v7.2, looks like</p>
<pre><code>~.   - terminate connection (and any multiplexed sessions)
~B   - send a BREAK to the remote system
~C   - open a command line
~R   - request rekey
~V/v - decrease/increase verbosity (LogLevel)
~^Z  - suspend ssh
~#   - list forwarded connections
~&amp;   - background ssh (when waiting for connections to terminate)
~?   - this message
~~   - send the escape character by typing it twice</code></pre>
<p>The most useful escape sequence is undoubtly <code>~.</code> (a tilde followed by a dot), which terminates the connection even when the terminal is unresponsive. This comes in very handy when either your connection or the remote machine's connection goes down and you want to get your terminal back.</p>
<p><strong>Nota Bene:</strong> <code>~</code> (the tilde character) should be the <em>very</em> first character on the command line.</p>
<hr />
<h1 id="debugging">Debugging</h1>
<h2 id="gdb">GDB</h2>
<p>Here is a a very short and non-comprehensive list of useful GDB commands:</p>
<ul>
<li><code>break example.c:22</code> create a breakpoint at line 22 of the file <code>example.c</code>.</li>
<li><code>break example.c:22 if i == 100</code> create a conditional breakpoint. It gets triggered only when the condition is met.</li>
<li><code>where</code> print the stack-trace after a segfault (or similar error).</li>
<li><code>up/down</code> move up (down) the stack-trace.</li>
<li><code>ptype</code> output the type of a variable.</li>
<li><code>info locals</code> display the name and value of all local variables.</li>
<li><code>disable 1</code> disable breakpoint number 1.</li>
</ul>
<hr />
<h1 id="uncategorized">Uncategorized</h1>
<h2 id="setting-up-nfs">Setting up NFS</h2>
<p><a href="https://en.wikipedia.org/wiki/Network_File_System">NFS</a> (Network File System) is a protocol that makes it possible to remotely (and transparently) access a file system over the network. Here I will explain how to setup a remote machine (aka the <em>server</em>) so that a local machine (aka the <em>client</em>) can have access to one or more of its directories.</p>
<ol style="list-style-type: decimal">
<li>Install the NFS server. On Ubuntu, this boils down to installing the <code>nfs-kernel-server</code> package.</li>
<li><p>Open (with root privilegies) the /etc/exports file. Add a line for each folder you want to export. The syntax is</p>
<p><code>PATH_TO_DIRECTORY  CLIENT(OPTIONS)</code></p>
<p>Note the lack of whitespace between CLIENT and the open parenthesis. The CLIENT field can be an IP address or a DNS name and can contain wildcards (<em>e.g.</em> <code>*</code> or <code>?</code>). The list of available options depend on the NFS server version and can be found online (for example <a href="https://linux.die.net/man/5/exports">here</a>. Valid configuration examples are</p>
<p><code>/home/lorenzo/RESULTS 192.168.0.10(rw,no_root_squash)</code> <code>/home/lorenzo/RESULTS *(ro,no_root_squash)</code></p>
<p>The above lines export the <code>/home/lorenzo/RESULTS</code> directory in read/write mode for the client identified by the IP address <code>192.168.0.10</code> and in read-only mode for everybody else.</p></li>
<li>Restart the NFS server. On many Linux distros this can be done with the command <code>sudo service nfs-kernel-server restart</code></li>
<li>On the client, install the NFS client (<code>nfs-common</code> on Ubuntu)</li>
<li><p>The remote filesystem can be mounted either manually (<code>sudo mount 192.168.0.1:/home/lorenzo/RESULTS /home/lorenzo/SERVER_RESULTS</code>) or automatically by adding a line like this to the <code>/etc/fstab</code> file:</p>
<p><code>192.168.0.1:/home/lorenzo/RESULTS /home/lorenzo/SERVER_RESULTS nfs rw,user,auto 0 0</code></p>
<p>and then using <code>sudo mount -a</code>. Here I assumed that the server has IP address <code>192.168.0.1</code> and that the directory <code>/home/lorenzo/CLIENT_RESULTS</code> exists on the client.</p></li>
</ol>
<p><strong>Nota Bene:</strong> on default installations, the shared directories are owned by the user and group identified by the <code>uid</code> and <code>gid</code> of the server, respectively. If the user on the client has a different <code>uid</code> and/or <code>gid</code>, its access to these directories may be limited. If this is the case (and if you are sure there will be no issues arising from such a drastic change) the best course of action is to change the user and group ids on either machine in order to make them match. This can done with the <code>usermod</code> command (<em>e.g.</em> <code>usermod -g 1110 -u 1205 lorenzo</code> will change lorenzo's <code>gid</code> and <code>uid</code> to 1110 and 1205, respectively). Note that <code>usermod</code> will change the ownership of all the files and directories that are in the user's home directory and are owned by them. The ownership of any other file or directory must be fixed manually.</p>
<h2 id="making-movies">Making movies</h2>
<p>We would like to generate a movie out of a (maybe very long) list of png images. We first create a file containing the list of png files sorted according to the order with which they should appear in the movie. If the names of the files are <code>img-1.png</code>, <code>img-2.png</code>, <em>etc.</em>, this can be accomplished by typing</p>
<pre><code>$ ls -1v img-*.png &gt; list.dat</code></pre>
<p>The <code>-v</code> option is a GNU extension that tells <code>ls</code> to order entries according to the natural sorting of the numbers contained in the entry names. If on your system this option is not supported or it does something else (this might be the case on BSD/OSX systems), then you can use the following command</p>
<pre><code>$ ls -1 img-*.png | sort -n -t&#39;-&#39; -k 2 &gt; list.dat</code></pre>
<p><code>-n</code> applies natural sorting, <code>-t'-'</code> tells sort to use dashes as the separators to split the entries it acts on into fields and <code>-k 2</code> to sort according to the value of the second field</p>
<p>A movie of width WIDTH, height HEIGHT and framerate FPS can now be generated by using <code>mencoder</code> with the following options:</p>
<pre><code>$ mencoder mf://@list.dat -mf w=WIDTH:h=HEIGHT:fps=FPS:type=png -ovc xvid -xvidencopts bitrate=200 -o output.avi</code></pre>
<p>The <code>-ovc xvid</code> controls the type of output and may not be suitable on all systems (or for all the purposes). The <code>-xvidencopts bitrate=200</code> option sets a sort of <em>overall</em> quality of the output.</p>
<h2 id="adding-a-fading-rounded-border-to-figures-with-gimp">Adding a fading, rounded border to figures with GIMP</h2>
<ol style="list-style-type: decimal">
<li>Select the whole picture (<code>ctrl + a</code>)</li>
<li>Shrink the border by an appropriate amount of pixels (Select → Shrink). I would say no more than 10% of the figure size.</li>
<li>Round the selection (Select → Rounded Rectangle)</li>
<li>Invert the selection (<code>ctrl + i</code>)</li>
<li>Feather the border (Select → Feather). I usually choose a number similar to the one used in step 2.</li>
<li>Delete the selected region (press delete)</li>
<li>Turn white into alpha (Colours → Colour to Alpha)</li>
<li>Create a new layer (same width and height as the figure) and put it underneath all other layers</li>
<li>Fill the layer with the background colour you want your picture to fade to at the border (usually black)</li>
</ol>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>In the following I will assume you are using the [OpenSSH][https://www.openssh.com/] client<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>It is not uncommon (at least not for me 😄) to have ten or more open connections at once!<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p><a href="https://lonesysadmin.net/2011/11/08/ssh-escape-sequences-aka-kill-dead-ssh-sessions/amp/" class="uri">https://lonesysadmin.net/2011/11/08/ssh-escape-sequences-aka-kill-dead-ssh-sessions/amp/</a><a href="#fnref3">↩</a></p></li>
</ol>
</div>
</body>
</html>
